FROM node:17-alpine

WORKDIR /app

ARG DOCKER_HOST_IP
ARG NEXTAUTH_SECRET
ARG NEXTAUTH_URL
ARG KEYCLOAK_CLIENT_ID
ARG KEYCLOAK_CLIENT_SECRET
ARG KEYCLOAK_REALM
ARG MAPBOX_TOKEN

ENV DOCKER_HOST_IP ${DOCKER_HOST_IP}
ENV NEXTAUTH_SECRET ${NEXTAUTH_SECRET}
ENV NEXTAUTH_URL ${NEXTAUTH_URL}
ENV KEYCLOAK_CLIENT_ID ${KEYCLOAK_CLIENT_ID}
ENV KEYCLOAK_CLIENT_SECRET ${KEYCLOAK_CLIENT_SECRET}
ENV KEYCLOAK_REALM ${KEYCLOAK_REALM}
ENV MAPBOX_TOKEN ${MAPBOX_TOKEN}

COPY ["package.json", "package-lock.json*", "./"]

RUN npm install --production

COPY . .

RUN npm run build

EXPOSE 3000

CMD ["npm", "run", "start"]